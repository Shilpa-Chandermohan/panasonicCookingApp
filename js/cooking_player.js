//Copyright (C) 2014 Panasonic Corporation. All Rights Reserved.
//
//*****************************************************************/
// File Name: cooking_player.js
// Purpose: This document creates the youtube player
// File Created Date: 28-Apr-2014
// Release Date: 10-Jun-2014
// Release Version: 0.3
//*****************************************************************/
var pop="";playerReady=false;var tag=document.createElement('script');tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName('script')[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);msToString=function(ms){var sec=Math.floor(ms/1000);var min=Math.floor(sec/60);var hrs=Math.floor(min/60);sec-=min*60;min-=hrs*60;return("0"+hrs).substr(-2,2)+":"+("0"+min).substr(-2,2)+":"+("0"+sec).substr(-2,2);};formatTime=function(secs){var hr=Math.floor(secs/3600);var min=Math.floor((secs-(hr*3600))/60);var sec=Math.floor(secs-(hr*3600)-(min*60));if(hr<10){hr="0"+hr;}
if(min<10){min="0"+min;}
if(sec<10){sec="0"+sec;}
var time=(hr=="00")?min+':'+sec:hr+':'+min+':'+sec;return time;};var player;function onYouTubeIframeAPIReady(){player=new YT.Player('player',{height:'1080',width:'1920',videoId:'',playerVars:{controls:0,autohide:0,modestbranding:1,showinfo:0,rel:0,},events:{'onReady':onPlayerReady,'onStateChange':onPlayerStateChange,'onPlaybackQualityChange':onPlaybackQualityChange,'onError':onError}});video=document.getElementById("player");video.className="player";try{playerControls.create();}catch(err){}}
function onPlayerReady(event){playerReady=true;}
function onPlaybackQualityChange(event){if(playerControls.setting.isVisible()){playerControls.setting.free();}
playerControls.setQualityValue(playerControls.MapList(player.getPlaybackQuality()));}
function onPlayerStateChange(event){switch(event.data){case YT.PlayerState.PLAYING:playerControls.togglePlay("play");playerControls.timeChange();playerControls.updateDuration();break;case YT.PlayerState.PAUSED:playerControls.deleteTimeChange();playerControls.togglePlay("pause");break;case YT.PlayerState.BUFFERING:playerControls.togglePlay("play");playerControls.deleteTimeChange();break;case YT.PlayerState.ENDED:playerControls.deleteTimeChange();playerControls.hide();playerControls.reset();player.clearVideo();break;default:playerControls.deleteTimeChange();playerControls.reset();break;}}
function onError(event){playerControls.deleteTimeChange();switch(event.data){case 2:break;case 100:break;case 101:break;default:break;}}
getPlayerState=function(){var state="";switch(player.getPlayerState()){case YT.PlayerState.PLAYING:state="playing";break;case YT.PlayerState.PAUSED:state="paused";break;case YT.PlayerState.BUFFERING:state="downloading";break;case YT.PlayerState.ENDED:state="finished";break;default:state="";break;}
return state;};Controls=function(){var bg=document.createElement('div'),basebg=document.createElement('div'),title=document.createElement('div'),titleTxt=document.createElement('div'),seekBg=document.createElement("div"),seek=document.createElement("input"),elapsed=document.createElement('div'),duration=document.createElement('div'),stop=document.createElement('div'),rewind=document.createElement('div'),play=document.createElement('div'),forward=document.createElement('div'),quality=document.createElement('div'),qualityHotkey=document.createElement('div'),currentItem=2,prevItem=null,SepPos=[85,175,261,350];this.components=[];this.parent="";this.state=null;this.Play_state="play";this.hideTime=0;this.isHidden=false;this.isVisible=false;this.create=function(){this.components=[];this.parent=document.getElementById("playerWrapper");basebg.className="controls_bgbase";basebg.id="controls_bgbase";bg.className="controls_bg";bg.id="controls_bg";title.className="playerTitle";title.id="playerTitle";titleTxt.className="titleText";titleTxt.id="titleText";title.appendChild(titleTxt);this.parent.appendChild(title);seek.type="range";seek.value=0;seek.min=0;seek.max=100;seek.step=1;seekBg.className="controls_seekBg";seek.className="controls_seek";elapsed.className="controls_elapsed";duration.className="controls_duration";elapsed.id="controls_elapsed";duration.id="controls_duration";elapsed.innerHTML="00:00";duration.innerHTML="00:00";stop.className="controls_stop";play.className="controls_play";rewind.className="controls_rewind";forward.className="controls_forward";quality.innerHTML="Auto";quality.className="controls_quality";qualityHotkey.className="controls_hotKey";seekBg.appendChild(seek);bg.appendChild(seekBg);bg.appendChild(elapsed);bg.appendChild(duration);bg.appendChild(stop);bg.appendChild(play);bg.appendChild(rewind);bg.appendChild(forward);bg.appendChild(quality);bg.appendChild(qualityHotkey);for(var i=0;i<4;i++){var separator=document.createElement('div');separator.className="controls_separator";separator.style.left=SepPos[i]+"px";bg.appendChild(separator);}
this.parent.appendChild(basebg);this.parent.appendChild(bg);stop.enter_focus=function(){stop.style.backgroundPosition="0 -540px";};stop.leave_focus=function(){stop.style.backgroundPosition="0 -480px";};play.enter_focus=function(){if(getPlayerState()==="paused"){play.style.backgroundPosition="0 -240px";}else{play.style.backgroundPosition="0 -180px";}};play.leave_focus=function(){if(getPlayerState()==="paused"){play.style.backgroundPosition="0 -300px";}else{play.style.backgroundPosition="0 -120px";}};rewind.enter_focus=function(){rewind.style.backgroundPosition="0 -360px";};rewind.leave_focus=function(){rewind.style.backgroundPosition="0 -420px";};forward.enter_focus=function(){forward.style.backgroundPosition="0 0";};forward.leave_focus=function(){forward.style.backgroundPosition="0 -60px";};quality.enter_focus=function(){quality.style.color="#ef4023";};quality.leave_focus=function(){quality.style.color="white";};this.components=[stop,rewind,play,forward,quality];};this.setQualityValue=function(value){var val=value||"Auto";quality.innerHTML=val;var Textwidth=quality.clientWidth;qualityHotkey.style.width=Textwidth+"px";qualityHotkey.style.display="inline";};this.hideHotKey=function(){qualityHotkey.style.display="none";};this.showHotKey=function(){qualityHotkey.style.display="inline";};this.resetQuality=function(){quality.innerHTML="Auto";qualityHotkey.style.width="58px";};this.timeChange=function(){this.timer=setInterval(this.updatePlayer,250);};this.deleteTimeChange=function(){clearInterval(this.timer);};this.disable=function(){document.getElementById("controls_bg").visibility="hidden";};this.setSeek=function(skip){skip=skip||0;seek.value=skip;value=(seek.value-seek.min)/(seek.max-seek.min);seek.style.backgroundImage=['-webkit-gradient(','linear, ','left top, ','right top, ','color-stop('+value+', #ef4023), ','color-stop('+value+', white)',')'].join('');};this.resetSeek=function(){seek.value=0;seek.style.backgroundImage=[];};this.resetCursor=function(){prevItem=currentItem=2;};this.updateDuration=function(){duration.innerHTML=formatTime(player.getDuration());};this.updateElapsed=function(time){var current=time||player.getCurrentTime();elapsed.innerHTML=formatTime(current);};this.durationReset=function(){duration.innerHTML="00:00";elapsed.innerHTML="00:00";};this.reset=function(){this.durationReset();this.resetSeek();this.resetCursor();this.resetQuality();this.setting.reset();};this.togglePlay=function(val){var state=val||"play";if(getPlayerState()==="paused"){if(currentItem===2){play.style.backgroundPosition="0 -240px";}else{play.style.backgroundPosition="0 -300px";}}else{if(currentItem===2){play.style.backgroundPosition="0 -180px";}else{play.style.backgroundPosition="0 -120px";}}};this.play_pause=function(){if(getPlayerState()=="playing"){player.pauseVideo();}else if(getPlayerState()=="paused"){player.playVideo();}};this.stopVideo=function(){player.stopVideo();};this.seekForward=function(){if(player.getCurrentTime()+10>player.getDuration()){this.hide();return;};playerControls.deleteTimeChange();var jump=(player.getCurrentTime()+10)*(100/player.getDuration());playerControls.setSeek(jump);this.updateElapsed(player.getCurrentTime()+10);player.seekTo(player.getCurrentTime()+10,true);if(getPlayerState()=="paused"){player.playVideo();}};this.seekBackward=function(){var jump=(player.getCurrentTime()-10)*(100/player.getDuration());playerControls.setSeek(jump);((player.getCurrentTime()-10)>0)?this.updateElapsed(player.getCurrentTime()-10):this.updateElapsed(0000);player.seekTo(player.getCurrentTime()-10,true);if(getPlayerState()=="paused"){player.playVideo();}};this.autoShow=function(){try{this.isHidden=false;this.hideTime=0;bg.style.visibility="visible";basebg.style.visibility="visible";title.style.visibility="visible";}catch(e){}};this.autoHide=function(){try{if(this.setting.On)
return true;this.isHidden=true;bg.style.visibility="hidden";basebg.style.visibility="hidden";title.style.visibility="hidden";}catch(e){}};this.updatePlayer=function(){try{var jump=player.getCurrentTime()*(100/player.getDuration());playerControls.setSeek(jump);playerControls.updateElapsed();playerControls.hideTime++;if(playerControls.hideTime>=20){playerControls.autoHide();playerControls.hideTime=0;}}catch(e){clearInterval(playerControls.timer);}};this.state=null;this.orgin=null;this.KeyboardEvent=function(e,eventType){target=main.target(e),keyCode=target.keyCode,key=main.keyCodeDic[keyCode];this.hideTime=0;if(this.isHidden){this.autoShow();e.preventDefault();return true;}
switch(eventType){case"keydown":switch(key){case"arrowdown":return false;break;case"arrowup":return true;break;case"ok":this.setAction(currentItem);return false;break;case"arrowright":if(getPlayerState()=="downloading"){e.preventDefault();return true;}
if(this.components[currentItem+1]){prevItem=currentItem;this.components[prevItem].leave_focus();this.components[++currentItem].enter_focus();}else{this.components[currentItem].leave_focus();this.components[0].enter_focus();prevItem=currentItem=0;}
return true;break;case"arrowleft":if(getPlayerState()=="downloading"){e.preventDefault();return true;}
if(this.components[currentItem-1]){prevItem=currentItem;this.components[prevItem].leave_focus();this.components[--currentItem].enter_focus();}else{this.components[currentItem].leave_focus();this.components[this.components.length-1].enter_focus();prevItem=currentItem=this.components.length-1;}
return true;case"return":try{e.preventDefault();if(this.setting.isVisible()){this.setting.free();return true;}
this.hide(e);}catch(e){}
return true;case"green":this.nextQuality();return true;case"red":return true;case"yellow":return true;case"blue":return true;}
break;}};this.enter_focus=function(){main.focusedDom=this;this.components[currentItem].enter_focus();};this.leave_focus=function(){this.components[currentItem].leave_focus();};this.nextQuality=function(){try{var List=player.getAvailableQualityLevels();var current=player.getPlaybackQuality();var currenIndex=List.indexOf(current);var nextQuality=(currenIndex+1>List.length-1)?0:currenIndex+1;player.setPlaybackQuality(List[nextQuality]);}catch(e){}};this.setAction=function(index){var val=index;switch(val){case 0:this.hide();break;case 1:this.seekBackward();break;case 2:this.play_pause();break;case 3:this.seekForward();break;case 4:try{if(!this.setting.On)
this.setting.create();}catch(e){}
break;default:break;}};this.MapList=function(value){var quality='';switch(value){case"hd1080":quality="1080p";break;case"hd720":quality="720p";break;case"large":quality="480p";break;case"medium":quality="360p";break;case"small":quality="240p";break;case"highres":quality="highres";break;default:quality=value;break;}
return quality;};this.MapOrginal=function(value){var quality='';switch(value){case"1080p":quality="hd1080";break;case"720p":quality="hd720";break;case"480p":quality="large";break;case"360p":quality="medium";break;case"240p":quality="small";break;case"highres":quality="highres";break;default:quality=value;break;}
return quality;};this.getQualityLevels=function(){try{var List=player.getAvailableQualityLevels();if(List.length===0){return List;}
List=List.map(this.MapList);return List;}catch(e){}};this.setting=new qualitySetting();this.settingFree=function(){this.setting.free();};this.setTitle=function(){titleTxt.innerHTML=detail.contentTitle||"";};this.show=function(id,prev){try{this.isVisible=true;this.parent=document.getElementById("playerWrapper");this.parent.style.display="inline";video.style.display="inline";document.getElementById("controls_bg").style.display="inline";this.setTitle();this.enter_focus();this.orgin=prev||null;if(this.isHidden){this.autoShow();}
player.loadVideoById({'videoId':id,'suggestedQuality':'default'});}catch(err){}};this.hide=function(e){self=this;try{document.getElementById("controls_bg").style.display="none";self.leave_focus();this.orgin.enter_focus();playerControls.deleteTimeChange();self.stopVideo();self.reset();self.parent.style.display="none";this.isVisible=false}catch(e){}};};qualitySetting=function(){this.On=false;this.components=[];var currentItem=0,prevItem=null;this.qualityOption=function(param){var bg=document.createElement('div'),text=document.createElement('div');bg.className="qualityItem_bg";bg.id="qualityItem_bg_"+param.id;text.className="qualityItem_text";text.id="qualityItem_text";text.innerHTML=param.text;bg.appendChild(text);bg.enter_focus=function(){this.style.backgroundColor="#ef4023";text.style.color="white";};bg.leave_focus=function(){this.style.backgroundColor="white";text.style.color="#6a6a6a";};bg.getValue=function(){return text.innerHTML;};return bg;};this.create=function(){var QualityList=playerControls.getQualityLevels(),parent=document.getElementById("controls_bg"),bg_parent=document.createElement('div'),bg=document.createElement('div'),heading=document.createElement('div'),qualityMenu=document.createElement('div'),hook=document.createElement('div');heading.className="quality_heading";qualityMenu.className="quality_menu";hook.className="quality_hook";bg_parent.className="quality_bg_parent";bg_parent.id="quality_bg_parent";if(document.getElementById("settingMenu")){parent.removeChild(parent.childNodes[parent.childNodes.length-1]);}
bg.appendChild(heading);bg.className="settingMenu";bg.id="settingMenu";for(var val in QualityList){if(val>6)
return true;qualityMenu.appendChild(this.qualityOption({text:QualityList[val],id:val}));}
bg.appendChild(qualityMenu);bg.appendChild(hook);bg_parent.appendChild(bg);parent.appendChild(bg_parent);var total=QualityList.length;if(total==4){document.getElementById("quality_bg_parent").style.top="-111px";}else if(total==5){document.getElementById("quality_bg_parent").style.top="-140px";}else if(total==6){document.getElementById("quality_bg_parent").style.top="-170px";}
this.components=[];while(total--){id="qualityItem_bg_"+total;this.components[total]=document.getElementById(id);}
this.components[this.components.length-1].style.border=0;playerControls.leave_focus();this.enter_focus();this.On=true;};this.resetCursor=function(){prevItem=currentItem=0;};this.reset=function(){this.On=false;this.resetCursor();parent=document.getElementById("controls_bg");if(document.getElementById("settingMenu")){parent.removeChild(parent.childNodes[parent.childNodes.length-1]);}};this.free=function(){this.On=false;this.resetCursor();parent=document.getElementById("controls_bg");if(document.getElementById("settingMenu")){parent.removeChild(parent.childNodes[parent.childNodes.length-1]);}
this.leave_focus();playerControls.enter_focus();playerControls.showHotKey();};this.isVisible=function(){var val=(document.getElementById("settingMenu"))?true:false;return val;};this.KeyboardEvent=function(e,eventType){target=main.target(e),keyCode=target.keyCode,key=main.keyCodeDic[keyCode];if(getPlayerState()=="downloading"&&key!="return"){e.preventDefault();return true;}
if(playerControls.isHidden){playerControls.autoShow();e.preventDefault();return true;}
switch(eventType){case"keydown":switch(key){case"arrowdown":if(this.components[currentItem+1]){prevItem=currentItem;this.components[prevItem].leave_focus();this.components[++currentItem].enter_focus();}else{this.components[currentItem].leave_focus();this.components[0].enter_focus();prevItem=currentItem=0;}
return true;break;case"arrowup":if(this.components[currentItem-1]){prevItem=currentItem;this.components[prevItem].leave_focus();this.components[--currentItem].enter_focus();}else{this.components[currentItem].leave_focus();this.components[this.components.length-1].enter_focus();prevItem=currentItem=this.components.length-1;}
return true;break;case"ok":try{this.setAction(currentItem);}catch(e){}
return false;break;case"return":try{e.preventDefault();this.free();}catch(e){}
return true;break;default:return true;break;}
break;}};this.enter_focus=function(){main.focusedDom=this;this.components[currentItem].enter_focus();};this.leave_focus=function(){this.components[currentItem].leave_focus();};this.getQualityValue=function(val){try{var value=val||"";return playerControls.MapOrginal(value);}catch(e){}};this.setAction=function(index){var val=this.getQualityValue(this.components[index].getValue());player.setPlaybackQuality(val);playerControls.setting.free();};};playerControls=new Controls();