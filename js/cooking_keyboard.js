//Copyright (C) 2014 Panasonic Corporation. All Rights Reserved.
//
//*****************************************************************/
// File Name: cooking_keyboard.js
// Purpose: This document creates the keyboard
// File Created Date: 28-Apr-2014
// Release Date: 10-Jun-2014
// Release Version: 0.3
//*****************************************************************/
main.keyboardContainer=(function($,document,keyboardContainer){"use strict";keyboardContainer={radioSelected:'',textboxValue:''};var keyboard={},sub,keyIndex,searchPlaceholder='Search #Foodhacks, Easy Recipes & More';(function(){var head=document.getElementsByTagName('head')[0];var link=document.createElement('link');link.rel='stylesheet';link.type='text/css';link.href='css/cooking_keyboard.css';head.appendChild(link);}());keyboard.create=function(){var keyboardOuter,mask;mask=document.createElement("div");document.body.appendChild(mask);mask.id='keyboardMask';keyboardOuter=document.createElement("div");document.body.appendChild(keyboardOuter);keyboardOuter.id='keyboardOuter';keyboardOuter.setAttribute('class','keyboardAnimTop');keyboardOuter.innerHTML='<div id="topContainer"><img id="keyboard_logo" src="images/logo.png" /><div id="radioContainer"><div id="radio_bg"></div><div id="linearAnim_radio"></div>'+'<span id="sortLabel">SORT BY:</span><div class="row"><div class="col"><ul><li class="radioList"><div id="MostRecent" class="radio radioSelected" value="0"></div><p class="normaltext">MostRecent</p></li><li>'+'<div id="MostPopular" class="radio radioNormal" value="1"></div><p class="normaltext">MostPopular</p></li><li><div id="MostDiscussed" class="radio radioNormal" value="2"></div><p class="normaltext">MostDiscussed</p></li></ul></div></div></div></div> '+'<div id="org"></div><div id="dup"></div><div id="keyboardContainer" class="show">'+'<div id="sortBy"></div>'+'<div id="emptyStringError"></div><div id="outer_search"><p>'+searchPlaceholder+'</p></div><input type="text" id="searchTextBox" maxlength="102"><div id="search_img"></div><ul id="keyboard">'+'<li id="row_1_1" class="specialChar focussedKey"><p class="false" style="padding-top:3px">`</p><p class="true">~</p></li>'+'<li id="row_1_2" class="specialChar"><p class="false">1</p><p class="true">!</p></li>'+'<li id="row_1_3" class="specialChar"><p class="false">2</p><p class="true">@</p></li>'+'<li id="row_1_4" class="specialChar"><p class="false">3</p><p class="true">#</p></li>'+'<li id="row_1_5" class="specialChar"><p class="false">4</p><p class="true">$</p></li>'+'<li id="row_1_6" class="specialChar"><p class="false">5</p><p class="true">%</p></li>'+'<li id="row_1_7" class="specialChar"><p class="false">6</p><p class="true">^</p></li>'+'<li id="row_1_8" class="specialChar"><p class="false">7</p><p class="true">&#38;</p></li>'+'<li id="row_1_9" class="specialChar"><p class="false">8</p><p class="true">*</p></li>'+'<li id="row_1_10" class="specialChar"><p class="false">9</p><p class="true">(</p></li>'+'<li id="row_1_11" class="specialChar"><p class="false">0</p><p class="true">)</p></li>'+'<li id="row_1_12" class="specialChar"><p class="false">-</p><p class="true">_</p></li>'+'<li id="row_1_13" class="specialChar"><p class="false">=</p><p class="true">+</p></li>'+'<li id="row_2_1" class="specialChar"><p class="false">;</p><p class="true">:</p></li>'+'<li id="row_2_2" class="specialChar"><p class="false">\'</p><p class="true">&quot;</p></li>'+'<li id="row_2_3" class="alphabet">q</li>'+'<li id="row_2_4" class="alphabet">w</li>'+'<li id="row_2_5" class="alphabet">e</li>'+'<li id="row_2_6" class="alphabet">r</li>'+'<li id="row_2_7" class="alphabet">t</li>'+'<li id="row_2_8" class="alphabet">y</li>'+'<li id="row_2_9" class="alphabet">u</li>'+'<li id="row_2_10" class="alphabet">i</li>'+'<li id="row_2_11" class="alphabet">o</li>'+'<li id="row_2_12" class="alphabet">p</li>'+'<li id="row_2_13" class="specialChar"><p class="false">\\</p><p class="true">|</p></li>'+'<li id="row_3_1" class="arrowLeft"><img id="shiftFocusLeft" src="images/shift_icon.png"/></li>'+'<li id="row_3_2" class="arrowRight"><img id="shiftFocusRight" src="images/shift_icon.png"/></li>'+'<li id="row_3_3" class="alphabet">a</li>'+'<li id="row_3_4" class="alphabet">s</li>'+'<li id="row_3_5" class="alphabet">d</li>'+'<li id="row_3_6" class="alphabet">f</li>'+'<li id="row_3_7" class="alphabet">g</li>'+'<li id="row_3_8" class="alphabet">h</li>'+'<li id="row_3_9" class="alphabet">j</li>'+'<li id="row_3_10" class="alphabet">k</li>'+'<li id="row_3_11" class="alphabet">l</li>'+'<li id="row_3_12" class="specialChar"><p class="false">[</p><p class="true">{</p></li>'+'<li id="row_3_13" class="specialChar"><p class="false">]</p><p class="true">}</p></li>'+'<li id="row_4_1" class="lShift">Shift</li>'+'<li id="row_4_2" class="alphabet">z</li>'+'<li id="row_4_3" class="alphabet">x</li>'+'<li id="row_4_4" class="alphabet">c</li>'+'<li id="row_4_5" class="alphabet">v</li>'+'<li id="row_4_6" class="alphabet">b</li>'+'<li id="row_4_7" class="alphabet">n</li>'+'<li id="row_4_8" class="alphabet">m</li>'+'<li id="row_4_9" class="specialChar"><p class="false">,</p><p class="true">&lt;</p></li>'+'<li id="row_4_10" class="specialChar"><p class="false">.</p><p class="true">&gt;</p></li>'+'<li id="row_4_11" class="specialChar"><p class="false">/</p><p class="true">?</p></li>'+'<li id="row_4_12" class="specialChar"><p class="false">@</p><p class="true">\'</p></li>'+'<li id="row_5_1" class="delete">'+'<div id="delText">Delete</div>'+'<div id="delImg"></div>'+'</li>'+'<li id="row_5_2" class="deleteAll">'+'<div id="delAllText">Delete All</div>'+'<div id="delAllImg"></div>'+'</li>'+'<li id="row_5_3" class="spaceBar">Space</li>'+'<li id="row_5_4" class="done">'+'<div id="doneText">Done</div>'+'<div id="doneImg"></div>'+'</li>'+'<li id="row_5_5" class="cancel">Cancel</li>'+'</ul>'+'</div>';};keyboard.free=function(){var mask,keyboard;mask=document.getElementById('keyboardMask');keyboard=document.getElementById('keyboardOuter');keyboard.innerHTML='';keyboard.parentNode.removeChild(keyboard);mask.parentNode.removeChild(mask);};keyboard.reset=function(){keyIndex=1;sub=1;};keyboardContainer.focusIn=function(focusSet){event.preventDefault();main.focusedDom=document.getElementById("keyboardContainer");if(sub==5&&focusSet==1){keyboard.reset();}else if(sub==1&&focusSet==5){keyIndex=1;sub=focusSet;}
keyboard.enter_focus();};keyboardContainer.hotKeypress=function(param){var parameter=param||"";switch(parameter){case"blue":keyboard.search();break;case"yellow":keyboard.Delete();break;case"green":keyboard.deleteAll();break;default:break;}};function getPrevInfo(){if(keyboardContainer.textboxValue!==''){$("#outer_search p").text("");$("#searchTextBox").val(keyboardContainer.textboxValue);}
if(keyboardContainer.radioSelected!==''){$('#MostRecent').removeClass('radioSelected').addClass('radioNormal');$('#'+keyboardContainer.radioSelected).removeClass('radioNormal').addClass('radioSelected');if(keyboardContainer.radioSelected==='MostRecent'){document.getElementById('radio_bg').className='mostrecentCursor';}
else if(keyboardContainer.radioSelected==='MostPopular'){document.getElementById('radio_bg').className='mostpopularCursor';}
else if(keyboardContainer.radioSelected==='MostDiscussed'){document.getElementById('radio_bg').className='mostdiscussedCursor';}
$('#'+keyboardContainer.radioSelected).next().removeClass('normaltext').addClass('selectedtext');}else if(keyboardContainer.radioSelected===''){$('#MostRecent').removeClass('radioNormal').addClass('radioSelected');$('#MostRecent').next().removeClass('normaltext').addClass('selectedtext');document.getElementById('radio_bg').className='mostrecentCursor';}}
keyboardContainer.animTop=function(){keyboard.create();getPrevInfo();if(main.keyboardContainer.isVisible){return;}
main.loading.isOn=true;main.keyboardContainer.isVisible=true;main.keyboardContainer.previousCursor=main.focusedDom||null;if(main.keyboardContainer.previousCursor&&main.keyboardContainer.previousCursor.leave_focus){main.keyboardContainer.previousCursor.leave_focus();}
$("#keyboardMask").removeClass('maskHide');$("#keyboardContainer").css("visibility","visible");$("#keyboardOuter").bind("animationend webkitAnimationEnd",function(){main.focusedDom=document.getElementById("keyboardContainer");keyboard.reset();keyboard.enter_focus();$("#searchTextBox").focus();main.loading.isOn=false;});};keyboardContainer.animDown=function(param){main.loading.isOn=true;main.fromYellowKey=false;main.keyboardContainer.isVisible=false;$("#keyboardOuter").removeClass('keyboardAnimTop').addClass('keyboardAnimDown');$("#keyboardOuter").bind("animationend webkitAnimationEnd",function(){$("#keyboardMask").addClass('maskHide');keyboard.leave_focus();if(!param&&main.keyboardContainer.previousCursor&&main.keyboardContainer.previousCursor.enter_focus){if(main.isDetail){detail.descObj.startScrollText();}
main.keyboardContainer.previousCursor.enter_focus();}
$("#searchTextBox").blur();$("#emptyStringError").html("");keyboard.reset();document.getElementById("keyboardContainer").style.visibility="hidden";$('#keyboardOuter').removeClass('showKeyboard').addClass('removeKeyboard');main.loading.isOn=false;keyboard.free();if(param){if(main.isDetail){clearInterval(detail.timer);main.clearGridList();innerSection.innerHTML="";main.isDetail=false;main.createInnerSection();}else{menuSection.innerHTML="";main.clearGridList();main.getApi();}
main.search.create_searchHeading();}});$("#errorPopUpMask_key").remove();};keyboard.enter_focus=function(){main.focusedDom=keyboardContainer;$("#row_"+sub+"_"+keyIndex).addClass('focussedKey');if("row_"+sub+"_"+keyIndex==='row_3_1'){$("#shiftFocusLeft").attr('src','images/shift_icon_w.png');}else if("row_"+sub+"_"+keyIndex==='row_3_2'){$("#shiftFocusRight").attr('src','images/shift_icon_w.png');}};keyboard.leave_focus=function(){$("#row_"+sub+"_"+keyIndex).removeClass('focussedKey');if("row_"+sub+"_"+keyIndex==='row_3_1'){$("#shiftFocusLeft").attr('src','images/shift_icon.png');}else if("row_"+sub+"_"+keyIndex==='row_3_2'){$("#shiftFocusRight").attr('src','images/shift_icon.png');}};keyboard.checkWidthLeft=function(selection_Start){$("#dup").text($("#searchTextBox").val().substring(0,selection_Start).replace(/\s/g,"\u00a0"));var wid=parseFloat($("#org").outerWidth())-parseFloat($("#dup").outerWidth());if(wid>=860){$("#searchTextBox").scrollLeft(parseFloat($("#dup").outerWidth()));}};keyboard.checkWidthRight=function(selection_Start){$("#dup").text($("#searchTextBox").val().substring(0,selection_Start).replace(/\s/g,"\u00a0"));if(parseFloat($("#dup").outerWidth())>=860){$("#searchTextBox").scrollLeft(parseFloat($("#dup").outerWidth()));}};keyboard.search=function(){var retval,orderBy;$("#emptyStringError").html("");$('#searchTextBox').val($('#searchTextBox').val().replace(/^\s\s*/,'').replace(/\s\s*$/,''));if($('#searchTextBox').val()===""||(jQuery.trim($('#searchTextBox').val())).length===0){$("#emptyStringError").html("Please enter any search keyword.");$('#searchTextBox').val("");retval=1;}else if(jQuery.trim($('#searchTextBox').val()).length<3){$("#emptyStringError").html("Please enter more than 2 characters.");retval=1;}else if(keyboardContainer.textboxValue===$('#searchTextBox').val()&&keyboardContainer.radioSelected===$('.radioSelected').attr('id')){$("#emptyStringError").html("Please enter different keyword (or) select other sort by option.");retval=1;}else{keyboardContainer.animDown("search");orderBy=$('.radioSelected').attr('id');main.categoryCode="Search";main.searchKey=$('#searchTextBox').val();main.filter=orderBy;keyboardContainer.textboxValue=$('#searchTextBox').val();keyboardContainer.radioSelected=$('.radioSelected').attr('id');main.fromSearch=true;retval=1;}
return retval;};keyboard.check=function(){if($('#searchTextBox').val().length>=0){$("#outer_search p").text("");}
if($('#searchTextBox').val().length>=$('#searchTextBox').attr('maxlength')){$("#emptyStringError").html("You have reached the limit of text.");return;}};keyboardContainer.textboxErrorcheck=function(param){var parameter=param||"";if(parameter!==''){if(parameter[0]==="specialChar"||parameter[0]==="alphabet"||parameter[0]==="spaceBar"){keyboard.check();}}else{keyboard.check();}};keyboard.keyClick=function(id){var shift=false,capslock=false,$key=$("#"+id),className=$key.attr('class').split(" "),keyPressedVal,ctl,e1,prevSelectionStart;keyboardContainer.textboxErrorcheck(className);keyPressedVal=$key.html();switch(className[0]){case'arrowLeft':ctl=document.getElementById('searchTextBox');ctl.selectionStart-=1;ctl.selectionEnd-=1;keyboard.checkWidthLeft(ctl.selectionStart);return false;case'arrowRight':ctl=document.getElementById('searchTextBox');ctl.selectionStart+=1;keyboard.checkWidthRight(ctl.selectionStart);return false;case'lShift':$('.alphabet').toggleClass('uppercase');$('.specialChar p').toggle();$(".acc").toggleClass('up');shift=(shift===true)?false:true;capslock=false;return false;case'caps':$('.alphabet').toggleClass('uppercase');$(".acc").toggleClass('up');capslock=true;return false;case'deleteAll':keyboard.deleteAll();return false;case'delete':keyboard.Delete();return false;case'done':keyboard.search();return false;case'cancel':keyboardContainer.animDown();return false;case'specialChar':keyPressedVal=$('p:visible',$key).html();break;case'spaceBar':keyPressedVal=' ';break;case'tabSpace':keyPressedVal="\t";break;}
if($('#searchTextBox').val().length>$('#searchTextBox').attr('maxlength')){return true;}
if($key.hasClass('specialChar')){keyPressedVal=$('p:visible',$key).html();}
if($key.hasClass('spaceBar')){keyPressedVal=' ';}
if($key.hasClass('deleteAll')){keyPressedVal="\n";}
if($key.hasClass('uppercase')){keyPressedVal=keyPressedVal.toUpperCase();}
if(shift===true){$('.specialChar p').toggle();if(capslock===false){$('.alphabet').toggleClass('uppercase');}
shift=false;}
if(keyPressedVal==='&amp;'){document.getElementById('searchTextBox').value+='&';return;}
if(keyPressedVal==='&lt;'){document.getElementById('searchTextBox').value+='<';return;}
if(keyPressedVal==='&gt;'){document.getElementById('searchTextBox').value+='>';return;}
try{e1=document.getElementById('searchTextBox');prevSelectionStart=e1.selectionStart+1;e1.value=e1.value.slice(0,e1.selectionStart)+keyPressedVal+e1.value.slice(e1.selectionEnd);e1.selectionStart=prevSelectionStart;e1.selectionEnd=prevSelectionStart;keyboard.checkWidthRight(e1.selectionStart);$("#org").text(e1.value);if($("#emptyStringError").text()==='Please enter any search keyword.'||$("#emptyStringError").text()==='Please enter different keyword (or) select other sort by option.'){$("#emptyStringError").html("");}
if(e1.value.length>2){$("#emptyStringError").html("");}}catch(ignore){}};keyboard.arrowRight=function(){keyIndex=keyIndex+1;if($("#row_"+sub+"_"+keyIndex).length){keyboard.enter_focus();keyIndex=keyIndex-1;keyboard.leave_focus();keyIndex=keyIndex+1;}else{keyIndex=keyIndex-1;keyboard.leave_focus();keyIndex=1;keyboard.enter_focus();}};keyboard.ArrowLeft=function(){keyIndex=keyIndex-1;if($("#row_"+sub+"_"+keyIndex).length){keyboard.enter_focus();keyIndex=keyIndex+1;keyboard.leave_focus();keyIndex=keyIndex-1;}else{keyIndex=keyIndex+1;keyboard.leave_focus();switch(sub){case'1':keyIndex=13;break;case'2':keyIndex=13;break;case'3':keyIndex=13;break;case'4':keyIndex=12;break;case'5':keyIndex=5;break;}
keyboard.enter_focus();}};keyboard.ArrowUp=function(){keyboard.leave_focus();switch(sub){case'5':if(keyIndex===3){keyIndex=4;}else if(keyIndex===4){keyIndex=9;}else if(keyIndex===5){keyIndex=11;}
break;case'4':if(keyIndex>=2){keyIndex=keyIndex+1;}
break;case'1':main.keyboardTop.enter_focus();return true;default:sub=sub-1;if($("#row_"+sub+"_"+keyIndex).length){keyboard.enter_focus();}else{keyIndex=keyIndex-1;keyboard.enter_focus();}
return true;}
sub=sub-1;keyboard.enter_focus();};keyboard.ArrowDown=function(){keyboard.leave_focus();switch(sub){case'3':if(keyIndex===1||keyIndex===2){keyIndex=1;}
if(keyIndex>=3&&keyIndex<=13){keyIndex=keyIndex-1;}
break;case'4':if(keyIndex===2||keyIndex===3){keyIndex=2;}else if(keyIndex>=4&&keyIndex<=8){keyIndex=3;}else if(keyIndex===9||keyIndex===10){keyIndex=4;}else if(keyIndex>=11){keyIndex=5;}
break;case'5':main.keyboardTop.enter_focus();return true;default:sub++;if($("#row_"+sub+"_"+keyIndex).length){keyboard.enter_focus();}else{keyIndex=keyIndex-1;keyboard.enter_focus();}
return true;}
sub++;keyboard.enter_focus();};keyboard.Delete=function(){if($('#searchTextBox').val()===""){return false;}
var html=$('#searchTextBox').val();var e1=document.getElementById('searchTextBox');var prevSelectionStart=e1.selectionStart-1;try{$("#searchTextBox").val(html.substring(0,e1.selectionStart-1)+html.substring(e1.selectionStart));}catch(e){}
e1.selectionStart=prevSelectionStart;e1.selectionEnd=prevSelectionStart;this.checkWidthRight(prevSelectionStart);$("#dup").text(e1.value);$("#org").text(e1.value);if($('#searchTextBox').val()===""){$("#outer_search p").text(searchPlaceholder);}
$("#emptyStringError").html("");return true;};keyboard.deleteAll=function(){$("#searchTextBox").val("");$("#outer_search p").text(searchPlaceholder);$("#org").text($('#searchTextBox').val());$("#dup").text($('#searchTextBox').val());$("#emptyStringError").html("");};keyboardContainer.KeyboardEvent=function(e,eventType){sub=$(".focussedKey").attr("id");sub=sub.split("_");sub=sub[1];var target=main.target(e),key=main.keyCodeDic[target.keyCode],id="row_"+sub+"_"+keyIndex;e.preventDefault();switch(eventType){case"keydown":switch(key){case"arrowright":keyboard.arrowRight();break;case"arrowleft":keyboard.ArrowLeft();break;case"arrowup":keyboard.ArrowUp();break;case"arrowdown":keyboard.ArrowDown();break;case"ok":id="row_"+sub+"_"+keyIndex;keyboard.keyClick(id);break;case"return":e.preventDefault();keyboardContainer.animDown();break;case"blue":keyboard.search();break;case"yellow":keyboard.Delete();break;case"green":keyboard.deleteAll();break;case"red":e.preventDefault();break;default:keyboardContainer.textboxErrorcheck();break;}
break;}
return true;};return keyboardContainer;}($,document,main.keyboardContainer));